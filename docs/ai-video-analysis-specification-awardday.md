# 4DX@HOME AIå‹•ç”»è§£æã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸ (AwardDayç‰ˆ)

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0  
**ä½œæˆæ—¥**: 2025å¹´12æœˆ15æ—¥  
**å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ**: JPHACKS 2025 Award Day (2025å¹´11æœˆ9æ—¥é–‹å‚¬)  
**ã‚·ã‚¹ãƒ†ãƒ **: Gemini 2.5 Proçµ±åˆç‰ˆ

---

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [Hack Day â†’ Award Day å¤‰æ›´å±¥æ­´](#hack-day--award-day-å¤‰æ›´å±¥æ­´)
4. [ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ](#ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ)
5. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
6. [è§£æãƒ¢ãƒ¼ãƒ‰](#è§£æãƒ¢ãƒ¼ãƒ‰)
7. [è¦–è´ç”¨å†ç”Ÿãƒ¢ãƒ¼ãƒ‰](#è¦–è´ç”¨å†ç”Ÿãƒ¢ãƒ¼ãƒ‰)
8. [ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONä»•æ§˜](#ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³jsonä»•æ§˜)
9. [å¯¾å¿œåŠ¹æœä¸€è¦§](#å¯¾å¿œåŠ¹æœä¸€è¦§)
10. [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ ](#ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ )
11. [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
12. [ä½¿ã„æ–¹](#ä½¿ã„æ–¹)
13. [è¨­å®šãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º](#è¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º)
14. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
15. [ä»Šå¾Œã®æ‹¡å¼µäºˆå®š](#ä»Šå¾Œã®æ‹¡å¼µäºˆå®š)
16. [é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](#é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ)
17. [å®Ÿè£…ä¾‹é›†](#å®Ÿè£…ä¾‹é›†)

---

## æ¦‚è¦

4DX@HOME AIå‹•ç”»è§£æã‚·ã‚¹ãƒ†ãƒ ã¯ã€ä»»æ„ã®MP4å‹•ç”»ã‚’è§£æã—ã¦4DXä½“é¨“ç”¨ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚Google Gemini 2.5 Proã®ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã€æ˜ åƒã‹ã‚‰æœ€é©ãªç‰©ç†ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’åˆ¤å®šã—ã¾ã™ã€‚

### ä½•ãŒã§ãã‚‹ã‹

```
MP4å‹•ç”» â†’ AIè§£æï¼ˆGemini 2.5 Proï¼‰â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSON â†’ 4DXä½“é¨“
```

### ç‰¹é•·

- **ã©ã‚“ãªå‹•ç”»ã§ã‚‚4DXåŒ–å¯èƒ½** - å°‚ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸è¦
- **AIè‡ªå‹•åˆ¤å®š** - æ‰‹å‹•è¨­å®šä¸è¦ã€ã‚·ãƒ¼ãƒ³ã®æ–‡è„ˆã‚’ç†è§£
- **é«˜ç²¾åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°** - 0.25ç§’é–“éš”ï¼ˆ4FPSï¼‰ã§ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
- **å¤§é‡ãƒãƒƒãƒå‡¦ç†** - 100æšåŒæ™‚è§£æã€ä¸¦åˆ—å®Ÿè¡Œï¼ˆæœ€å¤§10ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
- **ç²¾å¯†æŒ¯å‹•åˆ¶å¾¡** - èƒŒä¸­/ãŠã—ã‚Šåˆ¥ã®16ç¨®é¡æŒ¯å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
- **5ç¨®é¡ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ** - æŒ¯å‹•ãƒ»å…‰ãƒ»é¢¨ãƒ»æ°´ãƒ»è‰²

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ | ç”¨é€” |
|:--|:--|:--|
| **è¨€èª** | Python 3.7+ | ãƒ¡ã‚¤ãƒ³å‡¦ç† |
| **AI** | Google Gemini 2.5 Pro | ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«æ˜ åƒè§£æ |
| **å‹•ç”»å‡¦ç†** | OpenCV 4.8.0+ | ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡ºãƒ»ãƒ‡ã‚³ãƒ¼ãƒ‰ |
| **ç”»åƒå‡¦ç†** | Pillow | ç”»åƒãƒªã‚µã‚¤ã‚ºãƒ»å¤‰æ› |
| **ä¸¦åˆ—å‡¦ç†** | concurrent.futures | ä¸¦åˆ—APIå‘¼ã³å‡ºã— |

### AIè§£æã®æ¯”è¼ƒ

| é …ç›® | Geminiç‰ˆï¼ˆAward Dayï¼‰ | OpenAIç‰ˆï¼ˆHack Dayï¼‰ |
|:--|:--|:--|
| **ãƒ¢ãƒ‡ãƒ«** | Gemini 2.5 Pro | GPT-4o-mini |
| **ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°** | 0.25ç§’é–“éš”ï¼ˆ4FPSï¼‰ | 0.5ç§’é–“éš”ï¼ˆ2FPSï¼‰ |
| **ãƒãƒƒãƒã‚µã‚¤ã‚º** | 100æš | 15æš |
| **ä¸¦åˆ—å‡¦ç†** | æœ€å¤§10ãƒªã‚¯ã‚¨ã‚¹ãƒˆåŒæ™‚ | é€æ¬¡å‡¦ç† |
| **æŒ¯å‹•åˆ¶å¾¡** | 16ç¨®é¡ï¼ˆèƒŒä¸­/ãŠã—ã‚Šåˆ¥ï¼‰ | 3ç¨®é¡ï¼ˆå¼±/å¼·/ãƒ‰ã‚­ãƒ‰ã‚­ï¼‰ |
| **å‡ºåŠ›å½¢å¼** | ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ + åŠ¹æœJSON | ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã®ã¿ |

---

## Hack Day â†’ Award Day å¤‰æ›´å±¥æ­´

### AIãƒ¢ãƒ‡ãƒ«å¤‰æ›´

| é …ç›® | Hack Day | Award Day |
|:--|:--|:--|
| AIãƒ¢ãƒ‡ãƒ« | GPT-4o-mini | Gemini 2.5 Pro |
| API | OpenAI Vision API | Google Generative AI |
| å‡¦ç†æ–¹å¼ | é€æ¬¡å‡¦ç† | ä¸¦åˆ—å‡¦ç†ï¼ˆ10ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ |

### ç²¾åº¦å‘ä¸Š

| é …ç›® | Hack Day | Award Day |
|:--|:--|:--|
| ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš” | 0.5ç§’ | 0.25ç§’ |
| ãƒãƒƒãƒã‚µã‚¤ã‚º | 15æš | 100æš |
| æŒ¯å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ | 3ç¨®é¡ | 16ç¨®é¡ |

### æ–°æ©Ÿèƒ½

- **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ ** (`prompts.py`) - ç”¨é€”åˆ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ‡ã‚Šæ›¿ãˆ
- **4DX@HOMEå°‚ç”¨ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ** - ç²¾å¯†ãªæŒ¯å‹•åˆ¶å¾¡ç”¨
- **åŠ¹æœã®ç›´æ¥å‡ºåŠ›** - AIãŒã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨åŠ¹æœã‚’åŒæ™‚ã«è¿”ã™
- **æœ€å°ç¶™ç¶šæ™‚é–“åˆ¶å¾¡** - åŠ¹æœã®ãƒãƒ©ã¤ãé˜²æ­¢

---

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```mermaid
flowchart LR
    subgraph Input["ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›"]
        MP4[MP4å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«]
    end
    
    subgraph Analyze["è§£æãƒ¢ãƒ¼ãƒ‰"]
        A1[1. å‹•ç”»èª­ã¿è¾¼ã¿] --> A2[2. ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º] --> A3[3. ãƒªã‚µã‚¤ã‚º]
        A3 --> A4[4. ãƒãƒƒãƒå‡¦ç†] --> A5[5. ä¸¦åˆ—API] --> A6[6. Geminiè§£æ]
        A6 --> A7[7. JSONç”Ÿæˆ] --> A8[8. æœ€å°ç¶™ç¶šæ™‚é–“] --> A9[9. å‡ºåŠ›]
    end
    
    subgraph Output["å‡ºåŠ›"]
        JSON["results/video_name_timeline.json"]
    end
    
    subgraph Playback["å†ç”Ÿãƒ¢ãƒ¼ãƒ‰"]
        P1[å‹•ç”»+JSON] --> P2[å†ç”Ÿ] --> P3[åŒæœŸ] --> P4[è¡¨ç¤º] --> P5[åˆ¶å¾¡]
    end
    
    MP4 --> A1
    A9 --> JSON
    JSON --> P1
```

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
connotation_tools/
â”œâ”€â”€ analyze_video_gemini.py  # Geminiç‰ˆè§£æï¼ˆAward Dayï¼‰
â”œâ”€â”€ analyze_video.py         # OpenAIç‰ˆè§£æï¼ˆHack Dayäº’æ›ï¼‰
â”œâ”€â”€ playback_video.py        # è¦–è´ç”¨å†ç”Ÿ
â”œâ”€â”€ prompts.py               # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†
â”œâ”€â”€ requirements_gemini.txt  # Geminiç‰ˆä¾å­˜é–¢ä¿‚
â”œâ”€â”€ requirements.txt         # OpenAIç‰ˆä¾å­˜é–¢ä¿‚
â”œâ”€â”€ videos/                  # å…¥åŠ›å‹•ç”»é…ç½®
â”‚   â””â”€â”€ .gitkeep
â”œâ”€â”€ results/                 # å‡ºåŠ›JSON
â”‚   â””â”€â”€ .gitkeep
â”œâ”€â”€ archive/                 # æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆHack Dayç‰ˆï¼‰
â”‚   â”œâ”€â”€ deployment/
â”‚   â””â”€â”€ sync-generator/
â”œâ”€â”€ JSON_SPECIFICATION.md    # JSONä»•æ§˜æ›¸
â”œâ”€â”€ TECH_STACK.md            # æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°
â”œâ”€â”€ TIMING_GUIDE.md          # ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ PROMPT_GUIDE.md          # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ JSONç”Ÿæˆã‚¬ã‚¤ãƒ‰.md         # JSONç”Ÿæˆã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ Geminiç‰ˆä½¿ã„æ–¹.md         # Geminiç‰ˆã‚¬ã‚¤ãƒ‰
â””â”€â”€ README.md                # ç·åˆREADME
```

---

## è§£æãƒ¢ãƒ¼ãƒ‰

### å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart LR
    A[MP4å‹•ç”»] --> B[OpenCVèª­ã¿è¾¼ã¿] --> C[ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º<br/>0.25ç§’é–“éš”]
    C --> D[640pxãƒªã‚µã‚¤ã‚º] --> E[ãƒãƒƒãƒåˆ†å‰²<br/>100æš]
    E --> F[ä¸¦åˆ—API<br/>æœ€å¤§10åŒæ™‚] --> G[Gemini 2.5 Pro]
    G --> H[ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³+åŠ¹æœJSON] --> I[æœ€å°ç¶™ç¶šæ™‚é–“]
    I --> J[åŠ¹æœå»¶é•·/å‰Šé™¤] --> K[ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSON]
```

### è¨­å®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

```python
SAMPLE_INTERVAL = 0.25       # 0.25ç§’ã”ã¨ã«ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ï¼ˆ4FPSï¼‰
BATCH_SIZE = 100             # ä¸€åº¦ã«å‡¦ç†ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ æ•°
MODEL_NAME = "gemini-2.5-pro" # Geminiãƒ¢ãƒ‡ãƒ«å
TARGET_WIDTH = 640           # APIè² è·è»½æ¸›ã®ç¸®å°å¹…
MAX_CONCURRENT_REQUESTS = 10 # åŒæ™‚å®Ÿè¡Œæ•°ã®ä¸Šé™
PROMPT_NAME = "4dx_home"     # ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå
```

### å‡ºåŠ›ä¾‹

**å…¥åŠ›**: `videos/demo.mp4` (30ç§’å‹•ç”»)

**å‡ºåŠ›**: `results/demo_timeline_20251115_143022.json`

---

## è¦–è´ç”¨å†ç”Ÿãƒ¢ãƒ¼ãƒ‰

### æ©Ÿèƒ½

- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‹•ç”»å†ç”Ÿ**: OpenCVã«ã‚ˆã‚‹å‹•ç”»è¡¨ç¤º
- **éŸ³å£°å†ç”Ÿ**: pygame + ffmpegã«ã‚ˆã‚‹éŸ³å£°åŒæœŸ
- **åŠ¹æœãƒ‘ãƒãƒ«è¡¨ç¤º**: å³å´ã«ç¾åœ¨ã®åŠ¹æœçŠ¶æ…‹ã‚’è¡¨ç¤º
- **ãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡ä¿¡å·é€ä¿¡**: ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

### ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œ

| ã‚­ãƒ¼ | å‹•ä½œ |
|:--|:--|
| `ã‚¹ãƒšãƒ¼ã‚¹` | ä¸€æ™‚åœæ­¢/å†ç”Ÿ |
| `R` | æœ€åˆã‹ã‚‰å†ç”Ÿ |
| `Q` / `ESC` | çµ‚äº† |

---

## ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONä»•æ§˜

### åŸºæœ¬æ§‹é€ 

```json
{
  "events": [
    {
      "t": 0.0,
      "action": "caption",
      "text": "ã‚·ãƒ¼ãƒ³ã®èª¬æ˜æ–‡"
    },
    {
      "t": 0.0,
      "action": "start",
      "effect": "vibration",
      "mode": "down_weak"
    },
    {
      "t": 1.5,
      "action": "stop",
      "effect": "vibration",
      "mode": "down_weak"
    }
  ]
}
```

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—

| action | èª¬æ˜ | å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |
|:--|:--|:--|
| `caption` | ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤º | `t`, `text` |
| `start` | åŠ¹æœé–‹å§‹ | `t`, `effect`, `mode` |
| `stop` | åŠ¹æœåœæ­¢ | `t`, `effect`, `mode` |
| `shot` | ä¸€åº¦ãã‚Šã®ç™ºå°„ï¼ˆæ°´ï¼‰ | `t`, `effect`, `mode` |

### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|:--|:--|:--|
| `t` | float | æ™‚åˆ»ï¼ˆç§’ï¼‰ |
| `action` | string | ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ— |
| `effect` | string | åŠ¹æœã‚¿ã‚¤ãƒ— |
| `mode` | string | åŠ¹æœãƒ¢ãƒ¼ãƒ‰ |
| `text` | string | ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ |

---

## å¯¾å¿œåŠ¹æœä¸€è¦§

### æŒ¯å‹•ï¼ˆvibrationï¼‰- 16ç¨®é¡

#### ä¸Šï¼ˆèƒŒä¸­ï¼‰ã®ã¿

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `up_weak` | å¼± | å¤šå°‘ã®æŒ¯å‹• |
| `up_mid_weak` | ä¸­å¼± | å¤šå°‘ã®æŒ¯å‹• |
| `up_mid_strong` | ä¸­å¼· | å¼·çƒˆãªã‚·ãƒ¼ãƒ³ |
| `up_strong` | å¼· | å¼·çƒˆãªã‚·ãƒ¼ãƒ³ |

#### ä¸‹ï¼ˆãŠã—ã‚Šï¼‰ã®ã¿

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `down_weak` | å¼± | å¤šå°‘ã®æŒ¯å‹• |
| `down_mid_weak` | ä¸­å¼± | å¤šå°‘ã®æŒ¯å‹• |
| `down_mid_strong` | ä¸­å¼· | å¼·çƒˆãªã‚·ãƒ¼ãƒ³ |
| `down_strong` | å¼· | å¼·çƒˆãªã‚·ãƒ¼ãƒ³ |

#### ä¸Šä¸‹åŒæ™‚ï¼ˆèƒŒä¸­ï¼†ãŠã—ã‚Šï¼‰

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `up_down_weak` | å¼± | ã‹ãªã‚Šå¼·ã„ |
| `up_down_mid_weak` | ä¸­å¼± | ã‹ãªã‚Šå¼·ã„ |
| `up_down_mid_strong` | ä¸­å¼· | ã‹ãªã‚Šå¼·ã„ |
| `up_down_strong` | å¼· | ã‹ãªã‚Šå¼·ã„ |

#### ç‰¹æ®Š

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `heartbeat` | ãƒ‰ã‚­ãƒ‰ã‚­ | ç·Šå¼µã‚·ãƒ¼ãƒ³ |

### å…‰ï¼ˆflashï¼‰- 3ç¨®é¡

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `steady` | ç‚¹ç¯ | ç¶™ç¶šçš„ãªå…‰ |
| `slow_blink` | é…ã„ç‚¹æ»… | ã‚†ã£ãã‚Šãƒã‚«ãƒã‚« |
| `fast_blink` | æ—©ã„ç‚¹æ»… | é€Ÿããƒã‚«ãƒã‚« |

**æ³¨æ„**: é€šå¸¸ã‚·ãƒ¼ãƒ³ã§ã¯ä½¿ã‚ãªã„ã€‚éŠƒã®ç«ã€é–ƒå…‰ã€çˆ†ç™ºã€é›·ãªã©ç‰¹åˆ¥ãªå…‰ã‚’è¡¨ç¾ã™ã‚‹å ´åˆã®ã¿ä½¿ç”¨ã€‚

### é¢¨ï¼ˆwindï¼‰- 1ç¨®é¡

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `on` | é¢¨ã‚’å‡ºã™ | çˆ†é¢¨ã€ç–¾èµ° |

### æ°´ï¼ˆwaterï¼‰- 1ç¨®é¡

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `burst` | æ°´ã—ã¶ã | æ°´ãƒ»æ³¢ãƒ»å”¾ãƒ»æ±— |

**æ³¨æ„**: `shot`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ä¸€åº¦ã ã‘ç™ºå°„ã€‚`start`/`stop`ã¯ä½¿ç”¨ã—ãªã„ã€‚

### è‰²ï¼ˆcolorï¼‰- 6ç¨®é¡

| mode | èª¬æ˜ | ä½¿ç”¨ã‚·ãƒ¼ãƒ³ |
|:--|:--|:--|
| `red` | èµ¤ | ç‚ãƒ»ç«ãƒ»çˆ†ç™ºãƒ»è¡€ |
| `green` | ç·‘ | æ£®ãƒ»è‰åŸãƒ»è‡ªç„¶ |
| `blue` | é’ | ç©ºãƒ»æµ·ãƒ»æ°´ |
| `yellow` | é»„è‰² | æ˜ã‚‹ã„ã‚·ãƒ¼ãƒ³ |
| `cyan` | ã‚·ã‚¢ãƒ³ | æ°´ãƒ»ç©º |
| `purple` | ç´« | å¹»æƒ³çš„ãªã‚·ãƒ¼ãƒ³ |

### æœ€å°ç¶™ç¶šæ™‚é–“

| åŠ¹æœ | æœ€å°æ™‚é–“ |
|:--|:--|
| æŒ¯å‹•å…¨èˆ¬ | 0.5ç§’ |
| å…‰ï¼ˆç‚¹ç¯/é…ã„ç‚¹æ»…ï¼‰ | 2.0ç§’ |
| å…‰ï¼ˆæ—©ã„ç‚¹æ»…ï¼‰ | 1.0ç§’ |
| è‰²å…¨èˆ¬ | 2.0ç§’ |
| é¢¨ | 1.0ç§’ |
| æ°´ | 0.5ç§’ |

---

## ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚·ã‚¹ãƒ†ãƒ 

### æ¦‚è¦

`prompts.py` ã§è¤‡æ•°ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç®¡ç†ã—ã€ç”¨é€”ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã€‚

### åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

| åå‰ | èª¬æ˜ |
|:--|:--|
| `default` | æ¨™æº–ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³é‡è¦–ï¼‰ |
| `detailed` | è©³ç´°ãƒ¢ãƒ¼ãƒ‰ï¼ˆ3-5æ–‡ã®è©³ç´°è¨˜è¿°ï¼‰ |
| `simple` | ç°¡æ½”ãƒ¢ãƒ¼ãƒ‰ï¼ˆ1-2æ–‡ï¼‰ |
| `4dx_home` | 4DX@HOMEå°‚ç”¨ï¼ˆåŠ¹æœç›´æ¥å‡ºåŠ›ï¼‰ |

### ä½¿ç”¨ä¾‹

```python
from prompts import get_prompt, list_prompts

# åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸€è¦§
print(list_prompts())

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—
prompt = get_prompt("4dx_home", num_frames=100)
```

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd connotation_tools
pip install -r requirements_gemini.txt
```

å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:
- `opencv-python` - å‹•ç”»å‡¦ç†
- `google-generativeai` - Gemini API
- `Pillow` - ç”»åƒå‡¦ç†

### 2. Gemini APIã‚­ãƒ¼ã®å–å¾—

1. [Google AI Studio](https://makersuite.google.com/app/apikey) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒCreate API Keyã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. APIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼

### 3. APIã‚­ãƒ¼ã®è¨­å®š

#### æ–¹æ³•1: ã‚³ãƒ¼ãƒ‰å†…ã«è¨­å®šï¼ˆé–‹ç™ºç”¨ï¼‰

`analyze_video_gemini.py` ã®64è¡Œç›®ã‚’ç·¨é›†:

```python
HARD_CODED_GEMINI_API_KEY = "AIza..."
```

#### æ–¹æ³•2: ç’°å¢ƒå¤‰æ•°ã«è¨­å®šï¼ˆæ¨å¥¨ï¼‰

**Windows (PowerShell):**
```powershell
$env:GEMINI_API_KEY="AIza..."
```

**Linux/Mac:**
```bash
export GEMINI_API_KEY="AIza..."
```

### 4. å‹•ç”»ã‚’é…ç½®

```
connotation_tools/
â””â”€â”€ videos/
    â””â”€â”€ your_video.mp4
```

---

## ä½¿ã„æ–¹

### åŸºæœ¬ãƒ•ãƒ­ãƒ¼

```bash
# 1. å‹•ç”»ã‚’ videos/ ã«é…ç½®
videos/my_video.mp4

# 2. è§£æï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONç”Ÿæˆï¼‰
python analyze_video_gemini.py my_video.mp4

# 3. è¦–è´ç”¨å†ç”Ÿï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
python playback_video.py my_video.mp4
```

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿ï¼ˆvideos/ã‹ã‚‰è‡ªå‹•æ¤œç´¢ï¼‰
python analyze_video_gemini.py demo.mp4

# ãƒ•ãƒ«ãƒ‘ã‚¹æŒ‡å®š
python analyze_video_gemini.py "C:\path\to\video.mp4"

# åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’è¡¨ç¤º
python analyze_video_gemini.py --list-models

# åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¡¨ç¤º
python analyze_video_gemini.py --list-prompts

# ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
python analyze_video_gemini.py
```

### Windows ç°¡æ˜“å®Ÿè¡Œ

```batch
setup.bat          # åˆå›ã®ã¿
run_analyze.bat    # è§£æ
run_playback.bat   # å†ç”Ÿ
```

---

## è¨­å®šãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### è§£æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

`analyze_video_gemini.py` ã§è¨­å®šå¯èƒ½:

```python
SAMPLE_INTERVAL = 0.25       # ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”ï¼ˆç§’ï¼‰
BATCH_SIZE = 100             # ãƒãƒƒãƒã‚µã‚¤ã‚º
MODEL_NAME = "gemini-2.5-pro" # ãƒ¢ãƒ‡ãƒ«å
TARGET_WIDTH = 640           # ç”»åƒå¹…
MAX_CONCURRENT_REQUESTS = 10 # ä¸¦åˆ—æ•°
PROMPT_NAME = "4dx_home"     # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå
```

### æœ€å°ç¶™ç¶šæ™‚é–“

`analyze_video_gemini.py` ã® `MIN_DURATION` ã§è¨­å®š:

```python
MIN_DURATION = {
    "vibration:up_weak": 0.5,
    "flash:steady": 2.0,
    "color:red": 2.0,
    # ...
}
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### APIã‚­ãƒ¼ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `GEMINI_API_KEY ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`

**è§£æ±ºç­–**:
1. APIã‚­ãƒ¼ã‚’å–å¾—æ¸ˆã¿ã‹ç¢ºèª
2. ç’°å¢ƒå¤‰æ•°ã¾ãŸã¯ã‚³ãƒ¼ãƒ‰å†…ã«è¨­å®š
3. ã‚¹ãƒšãƒ«ãƒŸã‚¹ãŒãªã„ã‹ç¢ºèª

### å‹•ç”»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Could not open video file`

**è§£æ±ºç­–**:
1. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒæ­£ã—ã„ã‹ç¢ºèª
2. MP4å½¢å¼ã‹ç¢ºèª
3. `videos/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®

### ãƒãƒƒãƒå‡¦ç†ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `API rate limit exceeded`

**è§£æ±ºç­–**:
1. `MAX_CONCURRENT_REQUESTS` ã‚’ä¸‹ã’ã‚‹ï¼ˆ5ãªã©ï¼‰
2. `BATCH_SIZE` ã‚’ä¸‹ã’ã‚‹ï¼ˆ50ãªã©ï¼‰
3. æ•°åˆ†å¾…ã£ã¦ã‹ã‚‰å†å®Ÿè¡Œ

### ãƒ¡ãƒ¢ãƒªä¸è¶³

**ç—‡çŠ¶**: `MemoryError` ã¾ãŸã¯å‡¦ç†ãŒé…ã„

**è§£æ±ºç­–**:
1. `TARGET_WIDTH` ã‚’ä¸‹ã’ã‚‹ï¼ˆ480ãªã©ï¼‰
2. `BATCH_SIZE` ã‚’ä¸‹ã’ã‚‹
3. çŸ­ã„å‹•ç”»ã§åˆ†å‰²å‡¦ç†

---

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- [ ] ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‹•ç”»å¯¾å¿œï¼ˆYouTubeç­‰ï¼‰
- [ ] éŸ³å£°è§£æã®çµ±åˆï¼ˆBGMãƒ»åŠ¹æœéŸ³åˆ¤å®šï¼‰
- [ ] WebUIåŒ–ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰è§£æå®Ÿè¡Œï¼‰
- [ ] ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è§£æï¼ˆãƒ©ã‚¤ãƒ–é…ä¿¡å¯¾å¿œï¼‰
- [ ] å­¦ç¿’æ©Ÿèƒ½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åæ˜ ï¼‰

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸](./frontend-specification-awardday.md)
- [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸](./backend-specification-awardday.md)
- [ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä»•æ§˜æ›¸](./hardware-specification-awardday.md)
- [JSONä»•æ§˜æ›¸](../connotation_tools/JSON_SPECIFICATION.md)
- [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°](../connotation_tools/TECH_STACK.md)
- [ã‚¿ã‚¤ãƒŸãƒ³ã‚°èª¿æ•´ã‚¬ã‚¤ãƒ‰](../connotation_tools/TIMING_GUIDE.md)
- [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¬ã‚¤ãƒ‰](../connotation_tools/PROMPT_GUIDE.md)

---

## å®Ÿè£…ä¾‹é›†

ä»¥ä¸‹ã¯å„æ©Ÿèƒ½ã®è©³ç´°ãªå®Ÿè£…ä¾‹ã§ã™ã€‚

### ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º å®Ÿè£…ä¾‹

```python
def extract_frames(video_path: str, interval: float = 0.25) -> List[Tuple[float, np.ndarray]]:
    """
    å‹•ç”»ã‹ã‚‰ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æŠ½å‡ºã™ã‚‹
    
    Args:
        video_path: å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        interval: ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é–“éš”ï¼ˆç§’ï¼‰
    
    Returns:
        (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—, ãƒ•ãƒ¬ãƒ¼ãƒ ç”»åƒ) ã®ãƒªã‚¹ãƒˆ
    """
    cap = cv2.VideoCapture(video_path)
    fps = cap.get(cv2.CAP_PROP_FPS)
    frame_interval = int(fps * interval)
    
    frames = []
    frame_count = 0
    
    while True:
        ret, frame = cap.read()
        if not ret:
            break
        
        if frame_count % frame_interval == 0:
            timestamp = frame_count / fps
            # 640pxå¹…ã«ãƒªã‚µã‚¤ã‚º
            height, width = frame.shape[:2]
            new_width = 640
            new_height = int(height * new_width / width)
            resized = cv2.resize(frame, (new_width, new_height))
            frames.append((timestamp, resized))
        
        frame_count += 1
    
    cap.release()
    return frames
```

### Gemini APIå‘¼ã³å‡ºã— å®Ÿè£…ä¾‹

```python
import google.generativeai as genai
from concurrent.futures import ThreadPoolExecutor, as_completed

def analyze_batch_parallel(batches: List[List[Image]], prompt: str, max_workers: int = 10):
    """
    ãƒãƒƒãƒã‚’ä¸¦åˆ—ã§Gemini APIã«é€ä¿¡
    
    Args:
        batches: ç”»åƒãƒãƒƒãƒã®ãƒªã‚¹ãƒˆ
        prompt: è§£æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        max_workers: æœ€å¤§ä¸¦åˆ—æ•°
    
    Returns:
        è§£æçµæœã®ãƒªã‚¹ãƒˆ
    """
    model = genai.GenerativeModel(MODEL_NAME)
    results = [None] * len(batches)
    
    def process_batch(batch_idx: int, images: List[Image]) -> Tuple[int, dict]:
        """å˜ä¸€ãƒãƒƒãƒã‚’å‡¦ç†"""
        content = [prompt] + images
        response = model.generate_content(content)
        return batch_idx, parse_response(response.text)
    
    with ThreadPoolExecutor(max_workers=max_workers) as executor:
        futures = {
            executor.submit(process_batch, idx, batch): idx
            for idx, batch in enumerate(batches)
        }
        
        for future in as_completed(futures):
            batch_idx, result = future.result()
            results[batch_idx] = result
            print(f"âœ… ãƒãƒƒãƒ {batch_idx + 1}/{len(batches)} å®Œäº†")
    
    return results
```

### åŠ¹æœåˆ¤å®š å®Ÿè£…ä¾‹

```python
def decide_effects(caption: str, effects_from_ai: dict) -> List[Tuple[str, str]]:
    """
    ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã¨AIå‡ºåŠ›ã‹ã‚‰åŠ¹æœã‚’æ±ºå®š
    
    Args:
        caption: ã‚·ãƒ¼ãƒ³ã®ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³
        effects_from_ai: AIãŒå‡ºåŠ›ã—ãŸåŠ¹æœæƒ…å ±
    
    Returns:
        (effect, mode) ã®ãƒªã‚¹ãƒˆ
    """
    effects = []
    
    # AIãŒç›´æ¥å‡ºåŠ›ã—ãŸåŠ¹æœã‚’å„ªå…ˆ
    if effects_from_ai:
        for effect_type, modes in effects_from_ai.items():
            for mode in modes:
                if mode in EFFECT_DOMAIN.get(effect_type, []):
                    effects.append((effect_type, mode))
    
    # ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®è£œå®Œåˆ¤å®š
    caption_lower = caption.lower()
    
    # ä¹—ã‚Šç‰©æ­ä¹—ä¸­ â†’ å¼±ã„æŒ¯å‹•
    vehicle_keywords = ["ä¹—ã£ã¦ã„ã‚‹", "é‹è»¢ä¸­", "é£›è¡Œä¸­", "æ­ä¹—ä¸­"]
    if any(kw in caption for kw in vehicle_keywords):
        if ("vibration", "down_weak") not in effects:
            effects.append(("vibration", "down_weak"))
    
    # çˆ†ç™º â†’ å¼·ã„æŒ¯å‹• + é–ƒå…‰ + èµ¤è‰²
    if "çˆ†ç™º" in caption:
        effects.extend([
            ("vibration", "up_down_strong"),
            ("flash", "fast_blink"),
            ("color", "red")
        ])
    
    return list(set(effects))  # é‡è¤‡é™¤å»
```

### æœ€å°ç¶™ç¶šæ™‚é–“ãƒã‚§ãƒƒã‚¯ å®Ÿè£…ä¾‹

```python
def apply_min_duration(events: List[dict]) -> List[dict]:
    """
    æœ€å°ç¶™ç¶šæ™‚é–“ã‚’é©ç”¨ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’èª¿æ•´
    
    Args:
        events: å…ƒã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ
    
    Returns:
        èª¿æ•´å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ
    """
    adjusted = []
    active_effects = {}  # {(effect, mode): start_time}
    
    for event in sorted(events, key=lambda x: x['t']):
        if event['action'] == 'start':
            key = (event['effect'], event['mode'])
            active_effects[key] = event['t']
            adjusted.append(event)
        
        elif event['action'] == 'stop':
            key = (event['effect'], event['mode'])
            if key in active_effects:
                start_time = active_effects[key]
                duration = event['t'] - start_time
                min_dur = MIN_DURATION.get(f"{key[0]}:{key[1]}", 0.5)
                
                if duration < min_dur:
                    # æœ€å°ç¶™ç¶šæ™‚é–“ã¾ã§å»¶é•·
                    event['t'] = start_time + min_dur
                
                adjusted.append(event)
                del active_effects[key]
        
        elif event['action'] == 'shot':
            adjusted.append(event)
        
        elif event['action'] == 'caption':
            adjusted.append(event)
    
    return adjusted
```

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONç”Ÿæˆ å®Ÿè£…ä¾‹

```python
def generate_timeline_json(
    frames: List[Tuple[float, np.ndarray]],
    analysis_results: List[dict]
) -> dict:
    """
    è§£æçµæœã‹ã‚‰ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONã‚’ç”Ÿæˆ
    
    Args:
        frames: (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—, ãƒ•ãƒ¬ãƒ¼ãƒ ) ã®ãƒªã‚¹ãƒˆ
        analysis_results: å„ãƒ•ãƒ¬ãƒ¼ãƒ ã®è§£æçµæœ
    
    Returns:
        ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONè¾æ›¸
    """
    events = []
    prev_effects = set()
    
    for (timestamp, _), result in zip(frames, analysis_results):
        # ã‚­ãƒ£ãƒ—ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ
        if result.get('caption'):
            events.append({
                "t": round(timestamp, 2),
                "action": "caption",
                "text": result['caption']
            })
        
        # åŠ¹æœã‚¤ãƒ™ãƒ³ãƒˆ
        current_effects = set(decide_effects(
            result.get('caption', ''),
            result.get('effects', {})
        ))
        
        # æ–°ã—ãé–‹å§‹ã™ã‚‹åŠ¹æœ
        for effect, mode in current_effects - prev_effects:
            if effect == 'water':
                events.append({
                    "t": round(timestamp, 2),
                    "action": "shot",
                    "effect": effect,
                    "mode": "burst"
                })
            else:
                events.append({
                    "t": round(timestamp, 2),
                    "action": "start",
                    "effect": effect,
                    "mode": mode
                })
        
        # çµ‚äº†ã™ã‚‹åŠ¹æœ
        for effect, mode in prev_effects - current_effects:
            if effect != 'water':  # waterã¯shotå‹ãªã®ã§stopä¸è¦
                events.append({
                    "t": round(timestamp, 2),
                    "action": "stop",
                    "effect": effect,
                    "mode": mode
                })
        
        prev_effects = current_effects
    
    # æœ€å°ç¶™ç¶šæ™‚é–“ã‚’é©ç”¨
    events = apply_min_duration(events)
    
    return {"events": sorted(events, key=lambda x: x['t'])}
```

### ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾— å®Ÿè£…ä¾‹

```python
# prompts.py

PROMPTS = {
    "4dx_home": """
ä»¥ä¸‹ã®{num_frames}æšã®å‹•ç”»ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é †ç•ªã«è§£æã—ã¦ãã ã•ã„ã€‚
4DX@HOMEä½“æ„Ÿå‹ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆç”¨ã§ã™ã€‚

ã€å‡ºåŠ›å½¢å¼ã€‘
å„ãƒ•ãƒ¬ãƒ¼ãƒ ã«ã¤ã„ã¦ã€ä»¥ä¸‹ã®JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:
{{
  "frames": [
    {{
      "caption": "ã‚·ãƒ¼ãƒ³ã®èª¬æ˜ï¼ˆæ—¥æœ¬èª2-3æ–‡ï¼‰",
      "effects": {{
        "vibration": ["down_weak"],
        "flash": [],
        "wind": [],
        "water": [],
        "color": []
      }}
    }},
    ...
  ]
}}

ã€æŒ¯å‹•ã®åˆ¤å®šåŸºæº–ã€‘
- ä¹—ã‚Šç‰©æ­ä¹—ä¸­: down_weakï¼ˆç¶™ç¶šï¼‰
- è¡çªãƒ»çˆ†ç™ºã®ç¬é–“: up_down_strongï¼ˆç¬é–“ï¼‰
- æ¿€ã—ã„å‹•ã: up_mid_weak ã¾ãŸã¯ down_mid_weak
- ç·Šå¼µã‚·ãƒ¼ãƒ³: heartbeat

ã€ãã®ä»–ã®åŠ¹æœã€‘
- flash: çˆ†ç™ºãƒ»é›·ãƒ»é–ƒå…‰ã®ã¿ï¼ˆé€šå¸¸ã‚·ãƒ¼ãƒ³ã§ã¯ä½¿ã‚ãªã„ï¼‰
- color: ã‚·ãƒ¼ãƒ³ã®é›°å›²æ°—ã«åˆã‚ã›ã¦ï¼ˆç‚â†’redã€è‡ªç„¶â†’greenï¼‰
- wind: çˆ†é¢¨ãƒ»ç–¾èµ°æ™‚ã®ã¿
- water: æ°´ã—ã¶ããƒ»å”¾ã®ã¿ï¼ˆshotå‹ï¼‰
""",
    # ä»–ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ...
}

def get_prompt(name: str, num_frames: int) -> str:
    """ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å–å¾—"""
    template = PROMPTS.get(name, PROMPTS["default"])
    return template.format(num_frames=num_frames)

def list_prompts() -> List[str]:
    """åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåä¸€è¦§"""
    return list(PROMPTS.keys())
```

### ãƒ¡ã‚¤ãƒ³å‡¦ç† å®Ÿè£…ä¾‹

```python
def main(video_path: str):
    """
    ãƒ¡ã‚¤ãƒ³å‡¦ç†: å‹•ç”»è§£æ â†’ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONç”Ÿæˆ
    """
    print(f"ğŸ¬ å‹•ç”»è§£æé–‹å§‹: {video_path}")
    
    # 1. ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡º
    print("ğŸ“¸ ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡ºä¸­...")
    frames = extract_frames(video_path, SAMPLE_INTERVAL)
    print(f"   {len(frames)}ãƒ•ãƒ¬ãƒ¼ãƒ æŠ½å‡ºå®Œäº†")
    
    # 2. ãƒãƒƒãƒåˆ†å‰²
    batches = [
        frames[i:i+BATCH_SIZE]
        for i in range(0, len(frames), BATCH_SIZE)
    ]
    print(f"ğŸ“¦ {len(batches)}ãƒãƒƒãƒã«åˆ†å‰²")
    
    # 3. ç”»åƒã‚’PILå½¢å¼ã«å¤‰æ›
    image_batches = [
        [Image.fromarray(cv2.cvtColor(f[1], cv2.COLOR_BGR2RGB)) for f in batch]
        for batch in batches
    ]
    
    # 4. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå–å¾—
    prompt = get_prompt(PROMPT_NAME, BATCH_SIZE)
    
    # 5. ä¸¦åˆ—è§£æ
    print("ğŸ¤– Gemini 2.5 Pro è§£æä¸­...")
    results = analyze_batch_parallel(image_batches, prompt, MAX_CONCURRENT_REQUESTS)
    
    # 6. çµæœã‚’ãƒ•ãƒ©ãƒƒãƒˆåŒ–
    all_results = []
    for batch_result in results:
        all_results.extend(batch_result.get('frames', []))
    
    # 7. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONç”Ÿæˆ
    print("ğŸ“ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONç”Ÿæˆä¸­...")
    timeline = generate_timeline_json(frames, all_results)
    
    # 8. ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
    video_name = Path(video_path).stem
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    output_path = f"results/{video_name}_timeline_{timestamp}.json"
    
    with open(output_path, 'w', encoding='utf-8') as f:
        json.dump(timeline, f, ensure_ascii=False, indent=2)
    
    print(f"âœ… å®Œäº†: {output_path}")
    print(f"   ã‚¤ãƒ™ãƒ³ãƒˆæ•°: {len(timeline['events'])}")
    
    return output_path

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("ä½¿ã„æ–¹: python analyze_video_gemini.py <video.mp4>")
        sys.exit(1)
    
    main(sys.argv[1])
```

---

**å¤‰æ›´å±¥æ­´**:

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|-----|----------|---------|
| 2025-12-15 | 2.0.0 | Award Dayç‰ˆä»•æ§˜æ›¸ä½œæˆï¼ˆGemini 2.5 Proçµ±åˆï¼‰ |
