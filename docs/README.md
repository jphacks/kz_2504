# 4DX@HOME ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸

> **æœ€çµ‚æ›´æ–°**: 2025å¹´11æœˆ14æ—¥  
> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0 (Award Day Updated Version)

## ã¯ã˜ã‚ã«

4DX@HOMEã¯ã€AIå‹•ç”»è§£æã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸæŠ€è¡“ã«ã‚ˆã‚Šã€å‹•ç”»è¦–è´ã«ç‰©ç†ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹é©æ–°çš„ãªã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚æœ¬ä»•æ§˜æ›¸ã§ã¯ã€**Award Dayï¼ˆ2025å¹´11æœˆï¼‰æ™‚ç‚¹ã®æœ€æ–°å®Ÿè£…**ã«åŸºã¥ãã€ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹æˆã™ã‚‹3ã¤ã®ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŠ€è¡“ä»•æ§˜ã‚’è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚

### ğŸ†• Award Dayç‰ˆã§ã®ä¸»ãªå¤‰æ›´ç‚¹

> **å‰æ**: Hack Dayæ™‚ç‚¹ã§æ—¢ã«3å±¤æ§‹æˆï¼ˆFrontend â†” Cloud Run â†” Raspberry Piï¼‰ã¨Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤ã¯å®Œäº†ã—ã¦ã„ã¾ã—ãŸã€‚ãŸã ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¯æ±ºã‚æ‰“ã¡ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONã¯ãƒ©ã‚ºãƒ‘ã‚¤å´ã«å›ºå®šé…ç½®ã€ãƒ‡ãƒã‚¤ã‚¹èªè¨¼ãªã—ã€ã‚¹ã‚¿ãƒ¼ãƒˆä¿¡å·ã®ã¿ã§ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ¶å¾¡ã¯ãƒ©ã‚ºãƒ‘ã‚¤ä»»ã›ã¨ã„ã†çŠ¶æ…‹ã§ã—ãŸã€‚

#### ğŸ”Œ ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰é€£æºã®å®Œå…¨å®Ÿè£…
- âœ… **ãƒ‡ãƒã‚¤ã‚¹èªè¨¼ã‚·ã‚¹ãƒ†ãƒ **: è£½å“ã‚³ãƒ¼ãƒ‰ï¼ˆDH001/DH002/DH003ï¼‰ã«ã‚ˆã‚‹èªè¨¼æ©Ÿèƒ½
  - Hack Day: ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²APIã¯å­˜åœ¨ã—ãŸãŒæœªé€£æº
  - Award Day: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”»é¢çµ±åˆã€å®Ÿå‹•ä½œç¢ºèªå®Œäº†
- âœ… **ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONé€ä¿¡**: Cloud RunçµŒç”±ã§Raspberry Piã¸å‹•çš„é…ä¿¡
  - Hack Day: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³JSONã¯ãƒ©ã‚ºãƒ‘ã‚¤å´ã«äº‹å‰é…ç½®
  - Award Day: `POST /api/preparation/upload-timeline/{session_id}` ã§å‹•çš„é€ä¿¡
- âœ… **ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**: 5ãƒ‡ãƒã‚¤ã‚¹ï¼ˆWind/Water/LED/Motor1/Motor2ï¼‰ã®å‹•ä½œç¢ºèª
  - Hack Day: APIã¯å­˜åœ¨ã—ãŸãŒç”»é¢é€£æºãªã—
  - Award Day: VideoPreparationPageçµ±åˆã€å€‹åˆ¥ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆå¯èƒ½
- âœ… **æ™‚é–“åŒæœŸåˆ¶å¾¡**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰â†’Cloud Runâ†’Raspberry Pié–“ã®é«˜ç²¾åº¦æ™‚åˆ»åŒæœŸ
  - Hack Day: ã‚¹ã‚¿ãƒ¼ãƒˆä¿¡å·ã®ã¿ã€ãƒ©ã‚ºãƒ‘ã‚¤ãŒãƒ­ãƒ¼ã‚«ãƒ«ã§æ™‚åˆ»åˆ¤æ–­
  - Award Day: 200msé–“éš”åŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆVITE_SYNC_INTERVAL_MSï¼‰ã§é€£ç¶šåŒæœŸ
- âœ… **ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†**: ä¸€æ™‚åœæ­¢ãƒ»çµ‚äº†æ™‚ã®å…¨ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿å®‰å…¨åœæ­¢
  - Hack Day: å®Ÿè£…ãªã—
  - Award Day: `POST /api/playback/stop/{session_id}` + WebSocket `stop_signal` å®Œå…¨å®Ÿè£…

#### ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰çµ±åˆ
- âœ… **æœ¬ç•ªãƒ•ãƒ­ãƒ¼ç”»é¢å®Ÿè£…**: 3ç”»é¢æ§‹æˆã®å®Œå…¨ãªä½“é¨“ãƒ•ãƒ­ãƒ¼
  - `VideoSelectionPage` â†’ `VideoPreparationPage` â†’ `VideoPlaybackPage`
  - 4ã‚¹ãƒ†ãƒƒãƒ—æº–å‚™ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆæ¥ç¶šâ†’èª­è¾¼â†’é€ä¿¡â†’ãƒ†ã‚¹ãƒˆï¼‰
- âœ… **ã‚»ãƒƒã‚·ãƒ§ãƒ³IDç®¡ç†**: è£½å“ã‚³ãƒ¼ãƒ‰ï¼ˆå¤§æ–‡å­—ï¼‰ã¨å‹•çš„ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼ˆå°æ–‡å­—ï¼‰ã®åˆ†é›¢ç®¡ç†
- âœ… **ç’°å¢ƒå¤‰æ•°è¨­å®š**: `VITE_SYNC_INTERVAL_MS`, `VITE_SEEK_SYNC_INTERVAL_MS` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ms)

#### âš™ï¸ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢å¼·åŒ–
- âœ… **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢çµ±ä¸€åŒ–**: Arduinoå…¨å»ƒã€ESP-12E Ã— 4å°ã«çµ±ä¸€
  - Hack Day: Arduino Uno R3 Ã— 2å° + ESP-12E Ã— 1å°ï¼ˆã‚·ãƒªã‚¢ãƒ«é€šä¿¡ + MQTTæ··åœ¨ï¼‰
  - Award Day: ESP-12E Ã— 4å°ï¼ˆå…¨ã¦MQTTé€šä¿¡ã«çµ±ä¸€ã€Wi-Fiåˆ¶å¾¡ï¼‰
- âœ… **æ©Ÿä½“åˆ·æ–°**: 3Dãƒ—ãƒªãƒ³ãƒˆç­ä½“ã‚’æ–°è¦è¨­è¨ˆãƒ»è£½ä½œ
  - EffectStationç­ä½“ï¼ˆé¢¨ãƒ»æ°´ãƒ»å…‰ãƒ»è‰²ï¼‰
  - ActionDriveç­ä½“ï¼ˆæŒ¯å‹•Ã—8ãƒ¢ãƒ¼ã‚¿ãƒ¼ï¼‰
- âœ… **è‡ªå‹•èµ·å‹•ã‚·ã‚¹ãƒ†ãƒ **: Raspberry Pié›»æºæŠ•å…¥æ™‚ã«ã‚µãƒ¼ãƒãƒ¼è‡ªå‹•èµ·å‹•
  - systemdã‚µãƒ¼ãƒ“ã‚¹åŒ–
  - é›»æºã‚ªãƒ³ã§å³åº§ã«ç¨¼åƒå¯èƒ½
- âœ… **WebSocketè‡ªå‹•å†æ¥ç¶š**: `CloudRunWebSocketClient` (æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å†æ¥ç¶š)
- âœ… **å‹•çš„ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å‡¦ç†**: JSONå—ä¿¡â†’ãƒ‘ãƒ¼ã‚¹â†’ã‚¤ãƒ™ãƒ³ãƒˆå®Ÿè¡Œãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
  - `TimelineCacheManager`: å‹•çš„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†
  - `TimelineProcessor`: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
- âœ… **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ åŒ–**: 5ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆapi/, mqtt/, timeline/, server/, utils/ï¼‰
- âœ… **é€šä¿¡ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ **: `CommunicationLogger` å…¨é€šä¿¡ãƒˆãƒ¬ãƒ¼ã‚¹
- âœ… **Flaskç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**: ãƒ‡ãƒã‚¤ã‚¹çŠ¶æ…‹ãƒ»é€šä¿¡å±¥æ­´ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º (localhost:5000)

#### ğŸ› ï¸ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIæ‹¡å¼µ
- âœ… **æ–°è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ **:
  - `POST /api/preparation/upload-timeline/{session_id}` - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å‹•çš„é€ä¿¡
  - `POST /api/playback/stop/{session_id}` - ç·Šæ€¥åœæ­¢
  - `POST /api/device/test` - ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆ
  - `GET /api/playback/debug/*` - 6ãƒ‡ãƒãƒƒã‚°ãƒ«ãƒ¼ãƒˆï¼ˆsessions, connections, timeline, actuators, sync-history, logsï¼‰
- âœ… **æ–°ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹**: `ContinuousSyncService`, `PreparationService`, `SyncDataService`, `VideoService`

### ğŸ“š Hack Dayç‰ˆä»•æ§˜æ›¸ã«ã¤ã„ã¦

Hack Dayï¼ˆ2025å¹´10æœˆ11-12æ—¥ï¼‰æ™‚ç‚¹ã®æ—§ä»•æ§˜æ›¸ã¯ã€`archive/hackday-2025/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼ˆæœ€æ–°ç‰ˆï¼‰

```mermaid
graph TB
    subgraph "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å±¤"
        Frontend[React 18.3.1 Frontend<br/>https://kz-2504.onrender.com]
        DebugFrontend[Debug Frontend<br/>localhost:5173]
    end
    
    subgraph "ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å±¤ (Cloud Run)"
        CloudRun[FastAPI Backend<br/>Google Cloud Run<br/>asia-northeast1]
    end
    
    subgraph "ãƒ‡ãƒã‚¤ã‚¹å±¤"
        RaspberryPi[Raspberry Pi Server<br/>WebSocket Client]
        DebugHardware[Debug Hardware<br/>Simulator]
    end
    
    subgraph "ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹"
        EffectStation[EffectStation<br/>é¢¨ãƒ»æ°´ãƒ»å…‰ãƒ»è‰²<br/>3Dãƒ—ãƒªãƒ³ãƒˆç­ä½“]
        ActionDrive[ActionDrive<br/>æŒ¯å‹•Ã—8ãƒ¢ãƒ¼ã‚¿ãƒ¼<br/>3Dãƒ—ãƒªãƒ³ãƒˆç­ä½“]
    end
    
    Frontend -->|HTTPS/WSS| CloudRun
    DebugFrontend -->|HTTPS/WSS| CloudRun
    CloudRun -->|WebSocket| RaspberryPi
    CloudRun -->|WebSocket| DebugHardware
    
    RaspberryPi -->|Wi-Fi + MQTT| EffectStation
    RaspberryPi -->|Wi-Fi + MQTT| ActionDrive
```

### ä¸»è¦æ©Ÿèƒ½
- **AIå‹•ç”»è§£æ**: GPT-4o-mini Visionã«ã‚ˆã‚‹è‡ªå‹•4DXåŠ¹æœç”Ÿæˆ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ**: Â±50msä»¥å†…ã®é«˜ç²¾åº¦åŒæœŸ
- **å¤šæ§˜ãªç‰©ç†åŠ¹æœ**: æŒ¯å‹•ãƒ»å…‰ãƒ»é¢¨ãƒ»æ°´ãƒ»è‰²ã®5ç¨®é¡
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: 4æ¡ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ç°¡å˜ãƒšã‚¢ãƒªãƒ³ã‚°

## ä»•æ§˜æ›¸æ§‹æˆ

### ğŸ¯ æœ€æ–°ç‰ˆ (Award Day 2025) - Version 2.0.0

**å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ**: JPHACKS 2025 Award Day (2025å¹´11æœˆ9æ—¥é–‹å‚¬)

#### ğŸ“± [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸ (Award Dayç‰ˆ)](./frontend-specification-awardday.md)
**React + TypeScript Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ (Render + Cloud Runçµ±åˆç‰ˆ)**

- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Render Static Site (https://kz-2504.onrender.com)
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: React 18.3.1, TypeScript 5.0.0, Vite 5.0.0, Axios 1.6.0
- **ä¸»è¦æ©Ÿèƒ½**: 
  - 4ç”»é¢æ§‹æˆ (Home â†’ Pairing â†’ Select â†’ Player)
  - Cloud Run APIçµ±åˆ (REST + WebSocket)
  - 200msé–“éš”åŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
  - ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†çµ±åˆ (ä¸€æ™‚åœæ­¢ãƒ»å‹•ç”»çµ‚äº†æ™‚)
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: SPA, React Router, WebSocketè‡ªå‹•å†æ¥ç¶š
- **æ–°æ©Ÿèƒ½**: ã‚»ãƒƒã‚·ãƒ§ãƒ³IDåˆ†é›¢ç®¡ç†ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

#### ğŸ”§ [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸ (Award Dayç‰ˆ)](./backend-specification-awardday.md)  
**FastAPI Cloud Run APIã‚µãƒ¼ãƒãƒ¼**

- **ãƒ‡ãƒ—ãƒ­ã‚¤**: Google Cloud Run (asia-northeast1)
- **URL**: https://fdx-home-backend-api-xxxxxxxxxxxx.asia-northeast1.run.app
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: FastAPI 0.104.1, Uvicorn 0.24.0, WebSockets 11.0.3, Pydantic 2.5.0
- **ä¸»è¦æ©Ÿèƒ½**:
  - RESTful API (ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ãƒ»å‹•ç”»ç®¡ç†ãƒ»æº–å‚™å‡¦ç†ãƒ»å†ç”Ÿåˆ¶å¾¡)
  - WebSocket 3ç¨®é¡ (æº–å‚™ãƒ»ãƒ‡ãƒã‚¤ã‚¹ãƒ»å†ç”ŸåŒæœŸ)
  - ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†API (`POST /api/playback/stop/{session_id}`)
  - ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: 3å±¤æ§‹æˆ (Frontend â†” Cloud Run â†” Raspberry Pi)
- **ãƒªã‚½ãƒ¼ã‚¹**: 512Mi RAM, 1 vCPU, 300ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

#### âš™ï¸ [ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä»•æ§˜æ›¸ (Award Dayç‰ˆ)](./hardware-specification-awardday.md)
**Raspberry Pi Hub + ESP-12E ç‰©ç†åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ  (Cloud Runçµ±åˆç‰ˆ)**

- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: Python 3.9+, Flask 3.0.0, websockets 12.0, paho-mqtt 1.6.1
- **ä¸»è¦æ©Ÿèƒ½**:
  - Cloud Run WebSocketæ¥ç¶š (è‡ªå‹•å†æ¥ç¶š)
  - MQTTçµŒç”±ESP-12Eåˆ¶å¾¡ (5ãƒ‡ãƒã‚¤ã‚¹)
  - ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³ (Â±100msè¨±å®¹)
  - ã‚¹ãƒˆãƒƒãƒ—å‡¦ç† (å…¨ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼åœæ­¢)
  - Flaskç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (localhost:5000)
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: Raspberry Pi Hub â†’ MQTT Broker â†’ ESP-12E Devices
- **ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹**: Wind, Flash, LED Color, Motor1, Motor2

---

### ğŸ“¦ Hack Dayç‰ˆ (Version 1.0.0) - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

**å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ**: JPHACKS 2025 Hack Day (2025å¹´10æœˆ11-12æ—¥é–‹å‚¬)

Hack Dayæ™‚ç‚¹ã®ä»•æ§˜æ›¸ã¯ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™:

- [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸ (Hack Dayç‰ˆ)](./archive/hackday-2025/backend-specification.md)
- [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä»•æ§˜æ›¸ (Hack Dayç‰ˆ)](./archive/hackday-2025/frontend-specification.md)
- [ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ä»•æ§˜æ›¸ (Hack Dayç‰ˆ)](./archive/hackday-2025/hardware-specification.md)

## æŠ€è¡“çš„ç‰¹å¾´

### ğŸ¯ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
- **WebSocketåŒæ–¹å‘é€šä¿¡**ã«ã‚ˆã‚‹ç¶™ç¶šçš„æ™‚åˆ»åŒæœŸ
- **ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†**ã«ã‚ˆã‚‹ãƒãƒ³ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°åˆ¶å¾¡
- **äºˆæ¸¬è£œæ­£**ã«ã‚ˆã‚‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯é…å»¶å¯¾å¿œ

### ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant FE as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰<br/>(React)
    participant BE as ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰<br/>(Cloud Run)
    participant PI as Raspberry Pi<br/>(Hub)
    participant ESP as ESP-12E<br/>(Ã—4å°)
    
    FE->>BE: 1. å‹•ç”»å†ç”Ÿé–‹å§‹
    BE->>PI: 2. ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³é€ä¿¡
    
    loop 200msé–“éš”
        FE->>BE: 3. åŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ (time, state)
        BE->>PI: 4. æ™‚åˆ»è»¢é€
        PI->>PI: 5. ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢ (Â±100ms)
        PI->>ESP: 6. MQTTã‚³ãƒãƒ³ãƒ‰é€ä¿¡
        ESP->>ESP: 7. ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿åˆ¶å¾¡
    end
    
    FE->>BE: 8. åœæ­¢ä¿¡å·
    BE->>PI: 9. stop_signal
    PI->>ESP: 10. å…¨åœæ­¢ã‚³ãƒãƒ³ãƒ‰
```

**å‡¦ç†æ¦‚è¦**:
1. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: å‹•ç”»å†ç”Ÿãƒ»ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—é€ä¿¡
2. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ»åŒæœŸãƒ‡ãƒ¼ã‚¿è»¢é€
3. **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å‡¦ç†ãƒ»ç‰©ç†åŠ¹æœåˆ¶å¾¡

### ğŸ›¡ï¸ å®‰å…¨ãƒ»ä¿¡é ¼æ€§
- **å…¥åŠ›æ¤œè¨¼**: Pydanticã«ã‚ˆã‚‹å³å¯†ãªå‹ãƒã‚§ãƒƒã‚¯
- **ã‚¨ãƒ©ãƒ¼å›å¾©**: è‡ªå‹•å†æ¥ç¶šãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- **ç‰©ç†å®‰å…¨**: éç†±ä¿è­·ãƒ»å‹•ä½œæ™‚é–“åˆ¶é™ãƒ»ç·Šæ€¥åœæ­¢

## é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤

### é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
cd frontend/4dathome-app
npm install
npm run dev

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰  
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload

# ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢
cd hardware
pip install -r device-hub/requirements.txt
python3 hardware_server.py
```

### ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Node.js 18+, ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Python 3.9+, 512MB RAM
- **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢**: Raspberry Pi 3 Model B, ESP-12E Ã— 4å°, 3Dãƒ—ãƒªãƒ³ã‚¿ãƒ¼, 12V/5Aé›»æº

## APIä¸€è¦§

### RESTful API

```mermaid
flowchart LR
    subgraph Device["ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†"]
        D1[POST /api/device/register]
        D2[GET /api/device/info]
    end
    
    subgraph Video["å‹•ç”»ç®¡ç†"]
        V1[GET /api/videos/available]
        V2[POST /api/videos/select]
    end
    
    subgraph Prep["æº–å‚™å‡¦ç†"]
        P1[POST /api/preparation/start]
        P2[POST /api/preparation/upload-timeline]
    end
    
    subgraph Play["å†ç”Ÿåˆ¶å¾¡"]
        PL1[POST /api/playback/start]
        PL2[POST /api/playback/stop]
    end
```

- `POST /api/device/register` - ãƒ‡ãƒã‚¤ã‚¹ç™»éŒ²
- `GET /api/videos/available` - å‹•ç”»ä¸€è¦§å–å¾—
- `POST /api/videos/select` - å‹•ç”»é¸æŠ
- `POST /api/preparation/start/{session_id}` - æº–å‚™é–‹å§‹

### WebSocket

```mermaid
flowchart LR
    FE[Frontend] <-->|WSS| WS1[/api/preparation/ws/]
    FE <-->|WSS| WS2[/api/playback/ws/sync/]
    PI[Raspberry Pi] <-->|WSS| WS3[/api/playback/ws/device/]
```

- `ws://server/api/preparation/ws/{session_id}` - æº–å‚™å‡¦ç†é€šä¿¡
- `ws://server/api/playback/ws/sync/{session_id}` - å†ç”ŸåŒæœŸé€šä¿¡
- `ws://server/api/playback/ws/device/{session_id}` - ãƒ‡ãƒã‚¤ã‚¹é€šä¿¡

### ãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡ãƒ—ãƒ­ãƒˆã‚³ãƒ« (MQTT)

```mermaid
flowchart TB
    PI[Raspberry Pi<br/>MQTT Broker] --> T1["/4dx/motor1/control"]
    PI --> T2["/4dx/motor2/control"]
    PI --> T3["/4dx/wind"]
    PI --> T4["/4dx/water"]
    PI --> T5["/4dx/light"]
    PI --> T6["/4dx/color"]
    
    T1 --> ESP3[ESP#3 Motor1]
    T2 --> ESP4[ESP#4 Motor2]
    T3 --> ESP1[ESP#1 Wind/Water]
    T4 --> ESP1
    T5 --> ESP2[ESP#2 Light/Color]
    T6 --> ESP2
```

- **æŒ¯å‹•**: MQTT `/4dx/motor1/control`, `/4dx/motor2/control`
- **å…‰**: MQTT `/4dx/light`, `/4dx/color`
- **é¢¨**: MQTT `/4dx/wind`
- **æ°´**: MQTT `/4dx/water`
- **é€šä¿¡**: Wi-Fi (802.11n) + MQTT over TCP/IP

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç›®æ¨™å€¤ | ç”¨é€” |
|-----------|--------|------|
| APIå¿œç­”æ™‚é–“ | < 100ms | ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ |
| WebSocketé…å»¶ | < 50ms | åŒæœŸç²¾åº¦ |
| åŒæœŸç²¾åº¦ | Â±50ms | ä½“é¨“å“è³ª |
| åŒæ™‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ | 100+ | ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ | < 512MB | ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡ |

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ
1. **åŒæœŸãšã‚Œ**: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒãƒ»å‡¦ç†è² è·ç¢ºèª
2. **WebSocketæ¥ç¶šå¤±æ•—**: ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ»CORSè¨­å®šç¢ºèª  
3. **ãƒ‡ãƒã‚¤ã‚¹ç„¡å¿œç­”**: Wi-Fiæ¥ç¶šãƒ»ESP-12EçŠ¶æ…‹ç¢ºèª
4. **å‹•ç”»å†ç”Ÿã§ããªã„**: ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œãƒ»ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ç¢ºèª

### ãƒ­ã‚°ç¢ºèª
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°
tail -f backend/logs/app.log

# ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ­ã‚°  
journalctl -u 4dx-home.service -f

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
# ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ« Console
```

## ä»Šå¾Œã®æ‹¡å¼µè¨ˆç”»

```mermaid
gantt
    title 4DX@HOME æ‹¡å¼µãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
    dateFormat  YYYY-MM
    section Phase 1
    AIå‹•ç”»è§£æå¼·åŒ–      :2025-01, 2M
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ :2025-02, 2M
    ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½    :2025-03, 1M
    section Phase 2
    ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ã‚±ãƒ¼ãƒ«    :2025-04, 2M
    ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ OS      :2025-05, 2M
    æ©Ÿæ¢°å­¦ç¿’æœ€é©åŒ–      :2025-06, 2M
    section Phase 3
    ã‚µã‚¦ãƒ³ãƒ‰åŒæœŸ        :2025-07, 2M
    éŸ³æºåˆ†é›¢æŠ€è¡“        :2025-08, 2M
    section Phase 4
    ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«é–‹ç™º    :2025-09, 3M
    section Phase 5
    å¤šæ„Ÿè¦šçµ±åˆ          :2026-01, 3M
```

### Phase 1: æ©Ÿèƒ½æ‹¡å¼µ
- **AIå‹•ç”»è§£æ**: GPT-4o-mini Vision APIçµ±åˆ
- **å¤šå‹•ç”»å¯¾å¿œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
- **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šãƒ»ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

### Phase 2: æŠ€è¡“å‘ä¸Š
- **ã‚¯ãƒ©ã‚¦ãƒ‰åŒ–**: ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ OS**: ç¢ºå®šçš„ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- **æ©Ÿæ¢°å­¦ç¿’**: å€‹äººæœ€é©åŒ–ãƒ»äºˆæ¸¬åˆ¶å¾¡

### Phase 3: ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªé€£æºå¼·åŒ–
- **ã‚µã‚¦ãƒ³ãƒ‰åŒæœŸåˆ¶å¾¡**: éŸ³å£°æ³¢å½¢è§£æã«ã‚ˆã‚‹ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€£å‹•
- **éŸ³æºåˆ†é›¢æŠ€è¡“**: BGMãƒ»ç’°å¢ƒéŸ³ãƒ»ã‚»ãƒªãƒ•ã®è‡ªå‹•åˆ†é›¢ã¨ãƒãƒ£ãƒ³ãƒãƒ«åˆ¥å‡¦ç†
- **ç©ºé–“éŸ³éŸ¿**: 3DéŸ³å ´å†ç¾ã«ã‚ˆã‚‹æ–¹å‘æ„Ÿè¦šã®æ¼”å‡º
- **éŸ³éŸ¿åŠ¹æœæœ€é©åŒ–**: éŸ³åœ§ãƒ»å‘¨æ³¢æ•°å¸¯åŸŸã«å¿œã˜ãŸç‰©ç†ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¼·åº¦èª¿æ•´

### Phase 4: ã‚¦ã‚§ã‚¢ãƒ©ãƒ–ãƒ«æ‹¡å¼µ
- **ãƒãƒƒã‚¯ãƒãƒ³ãƒ‰å‹ãƒ‡ãƒã‚¤ã‚¹**: é¦–å…ƒã¸ã®å±€æ‰€çš„ãªæ¸©åº¦å¤‰åŒ–ãƒ»æŒ¯å‹•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- **ãƒªã‚¹ãƒˆãƒãƒ³ãƒ‰å‹ãƒ‡ãƒã‚¤ã‚¹**: æ‰‹é¦–ã§ã®å¿ƒæ‹ãƒ»æ¸©åº¦ãƒ»è§¦è¦šåˆºæ¿€ã«ã‚ˆã‚‹æ²¡å…¥æ„Ÿå‘ä¸Š
- **ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆ**: è£…ç€éƒ¨ä½ãƒ»åˆºæ¿€ç¨®é¡ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯¾å¿œ
- **ç”Ÿä½“æƒ…å ±é€£æº**: å¿ƒæ‹æ•°ãƒ»ä½“æ¸©ãªã©ã®ç”Ÿä½“ãƒ‡ãƒ¼ã‚¿ã«ã‚ˆã‚‹ä½“é¨“å€‹åˆ¥æœ€é©åŒ–

### Phase 5: æ–°ä½“é¨“
- **å¤šæ„Ÿè¦šçµ±åˆ**: æ¸©åº¦ãƒ»é¦™ã‚Šãƒ»è§¦è¦šã®è¿½åŠ ã¨éŸ³éŸ¿ã¨ã®åŒæœŸåˆ¶å¾¡
- **ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ä½“é¨“**: è¤‡æ•°äººåŒæ™‚ä½“é¨“ãƒ»æ„Ÿè¦šå…±æœ‰
- **VR/ARèåˆ**: ä»®æƒ³ç¾å®Ÿã¨ç‰©ç†ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®çµ±åˆ

## ã¾ã¨ã‚

4DX@HOMEã¯ã€æœ€æ–°ã®WebæŠ€è¡“ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã€çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã‚’çµ±åˆã—ã€å¾“æ¥ã®å‹•ç”»è¦–è´ä½“é¨“ã‚’é©æ–°ã™ã‚‹åŒ…æ‹¬çš„ãªã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‹¬ç«‹ã—ã¦å‹•ä½œã—ãªãŒã‚‰ã€é«˜ç²¾åº¦ãªåŒæœŸã«ã‚ˆã‚Šçµ±ä¸€ã•ã‚ŒãŸä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚

è©³ç´°ãªæŠ€è¡“ä»•æ§˜ã«ã¤ã„ã¦ã¯ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å°‚ç”¨ä»•æ§˜æ›¸ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

---

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å±¥æ­´

### Version 2.0.0 - Award Day 2025ï¼ˆ2025å¹´11æœˆ14æ—¥ï¼‰
- âœ… **Award Dayç‰ˆä»•æ§˜æ›¸ä½œæˆ** (3ãƒ•ã‚¡ã‚¤ãƒ«)
  - `backend-specification-awardday.md`
  - `frontend-specification-awardday.md`
  - `hardware-specification-awardday.md`
- âœ… **Cloud Runãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±è¿½åŠ **
  - URL: https://fdx-home-backend-api-xxxxxxxxxxxx.asia-northeast1.run.app
  - ãƒªã‚½ãƒ¼ã‚¹è¨­å®š: 512Mi RAM, 1 vCPU, 300ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- âœ… **ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†æ©Ÿèƒ½æ–‡æ›¸åŒ–**
  - REST API: `POST /api/playback/stop/{session_id}`
  - WebSocket: `stop_signal` ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ—
  - å…¨ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ãƒ¼åœæ­¢å‡¦ç†
- âœ… **3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³è¿½åŠ **
  - Frontend â†” Cloud Run API â†” Raspberry Pi
- âœ… **Hack Dayç‰ˆã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–åŒ–**
  - ç§»å‹•å…ˆ: `archive/hackday-2025/`

### Version 1.0.0 - Hack Dayï¼ˆ2025å¹´10æœˆ11-12æ—¥ï¼‰
- åˆå›ä»•æ§˜æ›¸ä½œæˆ
- åŸºæœ¬ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ–‡æ›¸åŒ–
- 2å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (Frontend â†” Backend â†” Hardware)

---

**åˆç‰ˆä½œæˆæ—¥**: 2025å¹´10æœˆ11æ—¥  
**æœ€çµ‚æ›´æ–°æ—¥**: 2025å¹´11æœˆ14æ—¥  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0.0 (Award Day Version)  
**å¯¾è±¡**: é–‹ç™ºãƒãƒ¼ãƒ ãƒ»æŠ€è¡“ä»•æ§˜ç¢ºèª

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¬ã‚¤ãƒ‰](../backend/DEPLOYMENT_GUIDE.md)
- [æœ¬ç•ªãƒ•ãƒ­ãƒ¼ä»•æ§˜](../debug_frontend/PRODUCTION_FLOW_SETUP.md)
- [ã‚¹ãƒˆãƒƒãƒ—å‡¦ç†ä»•æ§˜](../debug_frontend/STOP_SIGNAL_SPEC.md)
- [debug_hardware ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../debug_hardware/ARCHITECTURE.md)
